<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ThÃªm khÃ³a há»c (POST JSON)</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    .chapter { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 6px; }
    .lecture { margin-left: 20px; margin-top: 5px; }
    button { margin-top: 5px; }
    pre { background: #f6f6f6; padding: 10px; border-radius: 6px; }
  </style>
</head>
<body>
  <h2>ğŸ§© ThÃªm khÃ³a há»c má»›i</h2>

  <label>TÃªn khÃ³a há»c: <input type="text" id="courseTitle"></label>
  <br><br>
  <button onclick="addChapter()">â• ThÃªm chÆ°Æ¡ng</button>
  <div id="chapters"></div>

  <button onclick="submitCourse()">ğŸš€ Gá»­i lÃªn JSON Server</button>
  <pre id="output"></pre>

  <script>
    let chapterCount = 0;

    function addChapter() {
      chapterCount++;
      const container = document.getElementById("chapters");
      const div = document.createElement("div");
      div.className = "chapter";
      div.innerHTML = `
        <h3>ChÆ°Æ¡ng ${chapterCount}</h3>
        <label>TiÃªu Ä‘á» chÆ°Æ¡ng: <input type="text" class="chapter-title"></label><br>
        <button onclick="addLecture(this)">+ ThÃªm bÃ i giáº£ng</button>
        <div class="lectures"></div>
      `;
      container.appendChild(div);
    }

    function addLecture(button) {
      const div = document.createElement("div");
      div.className = "lecture";
      div.innerHTML = `
        <label>TÃªn bÃ i: <input type="text" class="lecture-title"></label>
        <label>Thá»i lÆ°á»£ng: <input type="text" class="lecture-duration" placeholder="03:20"></label>
        <label><input type="checkbox" class="lecture-preview"> Xem trÆ°á»›c</label>
      `;
      button.nextElementSibling.appendChild(div);
    }

    async function submitCourse() {
      const courseTitle = document.getElementById("courseTitle").value.trim();
      if (!courseTitle) return alert("Nháº­p tÃªn khÃ³a há»c trÆ°á»›c!");

      // Táº¡o danh sÃ¡ch chÆ°Æ¡ng
      const chapters = [];
      document.querySelectorAll(".chapter").forEach(ch => {
        const title = ch.querySelector(".chapter-title").value;
        const lectures = [];
        ch.querySelectorAll(".lecture").forEach(lec => {
          lectures.push({
            title: lec.querySelector(".lecture-title").value,
            duration: lec.querySelector(".lecture-duration").value,
            preview: lec.querySelector(".lecture-preview").checked
          });
        });
        chapters.push({
          chapter_title: title,
          lecture_count: lectures.length,
          lectures
        });
      });

      // Dá»¯ liá»‡u hoÃ n chá»‰nh
      const data = {
        course_title: courseTitle,
        total_sections: chapters.length,
        total_lectures: chapters.reduce((t, c) => t + c.lecture_count, 0),
        sections: chapters
      };

      // Gá»­i POST lÃªn json-server
      const response = await fetch("http://localhost:3000/courses", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      const result = await response.json();
      document.getElementById("output").textContent =
        "âœ… ÄÃ£ gá»­i thÃ nh cÃ´ng:\n" + JSON.stringify(result, null, 2);
    }
  </script>
</body>
</html>
